def fail_test(msg:String):Bool
    $errx(1, "Test failed: $msg")
    return no

if no or yes or fail_test("or failed to short circuit")
    $puts("or pass")
else fail_test("or gave wrong result")

if yes and no and fail_test("and failed to short circuit")
    fail_test("and gave wrong result")
else $puts("and pass")

tmp := no
tmp or= yes
tmp or= fail_test("or= failed to short circuit")
$puts("or= pass")
fail_test("or= gave wrong result") unless tmp

tmp = yes
tmp and= no
tmp and= fail_test("and= failed to short circuit")
$puts("and= pass")
fail_test("and= gave wrong result") if tmp

def doop():String
    maybe_str := yes ? nil; "ok"
    x:String = maybe_str or return "Successfully short circuited with return"
    fail "Failed to short circuit"
    return "x"

$puts(doop())

for i in 1..5
    maybe_str := yes ? nil; "ok"
    x:String = maybe_str or stop
    fail "Failed to short circuit"

$puts("Successfully short circuited with stop")

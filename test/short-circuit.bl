def fail_bool(msg:String):Bool
    fail "Test failed: $msg"
    return no

if no or yes or fail_bool("or failed to short circuit")
    $puts "or pass"
else fail "'or' gave wrong result"

if yes and no and fail_bool("and failed to short circuit")
    fail "and gave wrong result"
else $puts "and pass"

tmp := no
tmp or= yes
tmp or= fail_bool("or= failed to short circuit")
$puts "or= pass"
fail "or= gave wrong result" unless tmp

tmp = yes
tmp and= no
tmp and= fail_bool("and= failed to short circuit")
$puts "and= pass"
fail "and= gave wrong result" if tmp

def doop():String
    maybe_str := yes ? nil; "ok"
    x:String = maybe_str or return "Successfully short circuited with return"
    fail "Failed to short circuit"
    return "x"

$puts doop()

for i in 1..5
    maybe_str := yes ? nil; "ok"
    x:String = maybe_str or stop
    fail "Failed to short circuit"

$puts "Successfully short circuited with stop"

opt:String? = nil
opt or= "optstring"
fail unless opt == "optstring"
